name: Auto Comment on PR Merge

on:
  pull_request:
    types: [closed]

jobs:
  comment:
    runs-on: ubuntu-latest
    if: github.event.pull_request.merged == true
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2
    
    - name: Debug Information
      run: |
        echo "Event name: ${{ github.event_name }}"
        echo "PR number: ${{ github.event.pull_request.number }}"
        echo "Merged: ${{ github.event.pull_request.merged }}"
    
    - name: Add Comment to PR
      env:
        GH_PAT: ${{ secrets.GH_PAT_COMMENT }}
      run: |
        COMMENT=$(cat <<EOF
        {
          "body": "ðŸŽ‰ Your pull request has been successfully merged! ðŸŽ‰ Thank you for your valuable contribution to our project. Your efforts are greatly appreciated. Feel free to reach out if you have any more contributions or if there's anything else we can assist you with. Keep up the fantastic work! ðŸš€"
        }
        EOF
        )
        
        RESPONSE=$(curl -X POST \
          -H "Authorization: token $GH_PAT" \
          -H "Accept: application/vnd.github.v3+json" \
          "https://api.github.com/repos/${{ github.repository }}/issues/${{ github.event.pull_request.number }}/comments" \
          -d "$COMMENT" \
          -w "\n%{http_code}" \
          -s)
        HTTP_STATUS=$(echo "$RESPONSE" | tail -n1)
        BODY=$(echo "$RESPONSE" | sed '$d')
        
        echo "Response body: $BODY"
        echo "HTTP status: $HTTP_STATUS"
        
        if [ "$HTTP_STATUS" -ne 201 ]; then
          echo "Failed to post comment. Status code: $HTTP_STATUS"
          exit 1
        fi
        
        echo "Comment posted successfully!"
